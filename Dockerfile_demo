FROM node:18-alpine
WORKDIR /app

# install all deps for build (dev+prod)
COPY package*.json ./
RUN npm ci --prefer-offline

# copy source & build
COPY . ./
RUN npm run build     # emits dist/

# pg_isready for wait loop
RUN apk add --no-cache postgresql-client

# start script
RUN chmod +x start_demo.sh

EXPOSE 4000
ENV NODE_ENV=production

CMD ["./start_demo.sh"]
